const W="http://www.w3.org/2000/svg";class I{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}function M(e,t,s,i,n){return{type:"path",ops:C(e,t,s,i,n)}}function N(e,t,s){const i=(e||[]).length;if(i>2){const n=[];for(let a=0;a<i-1;a++)n.push(...C(e[a][0],e[a][1],e[a+1][0],e[a+1][1],s));return t&&n.push(...C(e[i-1][0],e[i-1][1],e[0][0],e[0][1],s)),{type:"path",ops:n}}return i===2?M(e[0][0],e[0][1],e[1][0],e[1][1],s):{type:"path",ops:[]}}function q(e,t,s,i,n){return function(a,r){return N(a,!0,r)}([[e,t],[e+s,t],[e+s,t+i],[e,t+i]],n)}function O(e,t,s,i,n){return function(a,r,o,c){const[w,g]=E(c.increment,a,r,c.rx,c.ry,1,c.increment*L(.1,L(.4,1,o),o),o);let m=A(w,null,o);if(!o.disableMultiStroke){const[d]=E(c.increment,a,r,c.rx,c.ry,1.5,0,o),l=A(d,null,o);m=m.concat(l)}return{estimatedPoints:g,opset:{type:"path",ops:m}}}(e,t,n,function(a,r,o){const c=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(a/2,2)+Math.pow(r/2,2))/2)),w=Math.max(o.curveStepCount,o.curveStepCount/Math.sqrt(200)*c),g=2*Math.PI/w;let m=Math.abs(a/2),d=Math.abs(r/2);const l=1-o.curveFitting;return m+=v(m*l,o),d+=v(d*l,o),{increment:g,rx:m,ry:d}}(s,i,n)).opset}function P(e){return e.randomizer||(e.randomizer=new I(e.seed||0)),e.randomizer.next()}function L(e,t,s,i=1){return s.roughness*i*(P(s)*(t-e)+e)}function v(e,t,s=1){return L(-e,e,t,s)}function C(e,t,s,i,n,a=!1){const r=a?n.disableMultiStrokeFill:n.disableMultiStroke,o=D(e,t,s,i,n,!0,!1);if(r)return o;const c=D(e,t,s,i,n,!0,!0);return o.concat(c)}function D(e,t,s,i,n,a,r){const o=Math.pow(e-s,2)+Math.pow(t-i,2),c=Math.sqrt(o);let w=1;w=c<200?1:c>500?.4:-.0016668*c+1.233334;let g=n.maxRandomnessOffset||0;g*g*100>o&&(g=c/10);const m=g/2,d=.2+.2*P(n);let l=n.bowing*n.maxRandomnessOffset*(i-t)/200,h=n.bowing*n.maxRandomnessOffset*(e-s)/200;l=v(l,n,w),h=v(h,n,w);const u=[],p=()=>v(m,n,w),f=()=>v(g,n,w);return r?u.push({op:"move",data:[e+p(),t+p()]}):u.push({op:"move",data:[e+v(g,n,w),t+v(g,n,w)]}),r?u.push({op:"bcurveTo",data:[l+e+(s-e)*d+p(),h+t+(i-t)*d+p(),l+e+2*(s-e)*d+p(),h+t+2*(i-t)*d+p(),s+p(),i+p()]}):u.push({op:"bcurveTo",data:[l+e+(s-e)*d+f(),h+t+(i-t)*d+f(),l+e+2*(s-e)*d+f(),h+t+2*(i-t)*d+f(),s+f(),i+f()]}),u}function A(e,t,s){const i=e.length,n=[];if(i>3){const a=[],r=1-s.curveTightness;n.push({op:"move",data:[e[1][0],e[1][1]]});for(let o=1;o+2<i;o++){const c=e[o];a[0]=[c[0],c[1]],a[1]=[c[0]+(r*e[o+1][0]-r*e[o-1][0])/6,c[1]+(r*e[o+1][1]-r*e[o-1][1])/6],a[2]=[e[o+1][0]+(r*e[o][0]-r*e[o+2][0])/6,e[o+1][1]+(r*e[o][1]-r*e[o+2][1])/6],a[3]=[e[o+1][0],e[o+1][1]],n.push({op:"bcurveTo",data:[a[1][0],a[1][1],a[2][0],a[2][1],a[3][0],a[3][1]]})}}else i===3?(n.push({op:"move",data:[e[1][0],e[1][1]]}),n.push({op:"bcurveTo",data:[e[1][0],e[1][1],e[2][0],e[2][1],e[2][0],e[2][1]]})):i===2&&n.push(...C(e[0][0],e[0][1],e[1][0],e[1][1],s));return n}function E(e,t,s,i,n,a,r,o){const c=[],w=[],g=v(.5,o)-Math.PI/2;w.push([v(a,o)+t+.9*i*Math.cos(g-e),v(a,o)+s+.9*n*Math.sin(g-e)]);for(let m=g;m<2*Math.PI+g-.01;m+=e){const d=[v(a,o)+t+i*Math.cos(m),v(a,o)+s+n*Math.sin(m)];c.push(d),w.push(d)}return w.push([v(a,o)+t+i*Math.cos(g+2*Math.PI+.5*r),v(a,o)+s+n*Math.sin(g+2*Math.PI+.5*r)]),w.push([v(a,o)+t+.98*i*Math.cos(g+r),v(a,o)+s+.98*n*Math.sin(g+r)]),w.push([v(a,o)+t+.9*i*Math.cos(g+.5*r),v(a,o)+s+.9*n*Math.sin(g+.5*r)]),[w,c]}function $(e,t){return{maxRandomnessOffset:2,roughness:e==="highlight"?3:1.5,bowing:1,stroke:"#000",strokeWidth:1.5,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,combineNestedSvgPaths:!1,disableMultiStroke:e!=="double",disableMultiStrokeFill:!1,seed:t}}function F(e,t,s,i,n,a){const r=[];let o=s.strokeWidth||2;const c=function(l){const h=l.padding;if(h||h===0){if(typeof h=="number")return[h,h,h,h];if(Array.isArray(h)){const u=h;if(u.length)switch(u.length){case 4:return[...u];case 1:return[u[0],u[0],u[0],u[0]];case 2:return[...u,...u];case 3:return[...u,u[1]];default:return[u[0],u[1],u[2],u[3]]}}}return[5,5,5,5]}(s),w=s.animate===void 0||!!s.animate,g=s.iterations||2,m=s.rtl?1:0,d=$("single",a);switch(s.type){case"underline":{const l=t.y+t.h+c[2];for(let h=m;h<g+m;h++)h%2?r.push(M(t.x+t.w,l,t.x,l,d)):r.push(M(t.x,l,t.x+t.w,l,d));break}case"strike-through":{const l=t.y+t.h/2;for(let h=m;h<g+m;h++)h%2?r.push(M(t.x+t.w,l,t.x,l,d)):r.push(M(t.x,l,t.x+t.w,l,d));break}case"box":{const l=t.x-c[3],h=t.y-c[0],u=t.w+(c[1]+c[3]),p=t.h+(c[0]+c[2]);for(let f=0;f<g;f++)r.push(q(l,h,u,p,d));break}case"bracket":{const l=Array.isArray(s.brackets)?s.brackets:s.brackets?[s.brackets]:["right"],h=t.x-2*c[3],u=t.x+t.w+2*c[1],p=t.y-2*c[0],f=t.y+t.h+2*c[2];for(const y of l){let _;switch(y){case"bottom":_=[[h,t.y+t.h],[h,f],[u,f],[u,t.y+t.h]];break;case"top":_=[[h,t.y],[h,p],[u,p],[u,t.y]];break;case"left":_=[[t.x,p],[h,p],[h,f],[t.x,f]];break;case"right":_=[[t.x+t.w,p],[u,p],[u,f],[t.x+t.w,f]]}_&&r.push(N(_,!1,d))}break}case"crossed-off":{const l=t.x,h=t.y,u=l+t.w,p=h+t.h;for(let f=m;f<g+m;f++)f%2?r.push(M(u,p,l,h,d)):r.push(M(l,h,u,p,d));for(let f=m;f<g+m;f++)f%2?r.push(M(l,p,u,h,d)):r.push(M(u,h,l,p,d));break}case"circle":{const l=$("double",a),h=t.w+(c[1]+c[3]),u=t.h+(c[0]+c[2]),p=t.x-c[3]+h/2,f=t.y-c[0]+u/2,y=Math.floor(g/2),_=g-2*y;for(let b=0;b<y;b++)r.push(O(p,f,h,u,l));for(let b=0;b<_;b++)r.push(O(p,f,h,u,d));break}case"highlight":{const l=$("highlight",a);o=.95*t.h;const h=t.y+t.h/2;for(let u=m;u<g+m;u++)u%2?r.push(M(t.x+t.w,h,t.x,h,l)):r.push(M(t.x,h,t.x+t.w,h,l));break}}if(r.length){const l=function(y){const _=[];for(const b of y){let x="";for(const S of b.ops){const k=S.data;switch(S.op){case"move":x.trim()&&_.push(x.trim()),x=`M${k[0]} ${k[1]} `;break;case"bcurveTo":x+=`C${k[0]} ${k[1]}, ${k[2]} ${k[3]}, ${k[4]} ${k[5]} `;break;case"lineTo":x+=`L${k[0]} ${k[1]} `}}x.trim()&&_.push(x.trim())}return _}(r),h=[],u=[];let p=0;const f=(y,_,b)=>y.setAttribute(_,b);for(const y of l){const _=document.createElementNS(W,"path");if(f(_,"d",y),f(_,"fill","none"),f(_,"stroke",s.color||"currentColor"),f(_,"stroke-width",""+o),w){const b=_.getTotalLength();h.push(b),p+=b}e.appendChild(_),u.push(_)}if(w){let y=0;for(let _=0;_<u.length;_++){const b=u[_],x=h[_],S=p?n*(x/p):0,k=i+y,R=b.style;R.strokeDashoffset=""+x,R.strokeDasharray=""+x,R.animation=`rough-notation-dash ${S}ms ease-out ${k}ms forwards`,y+=S}}}}class J{constructor(t,s){this._state="unattached",this._resizing=!1,this._seed=Math.floor(Math.random()*2**31),this._lastSizes=[],this._animationDelay=0,this._resizeListener=()=>{this._resizing||(this._resizing=!0,setTimeout(()=>{this._resizing=!1,this._state==="showing"&&this.haveRectsChanged()&&this.show()},400))},this._e=t,this._config=JSON.parse(JSON.stringify(s)),this.attach()}get animate(){return this._config.animate}set animate(t){this._config.animate=t}get animationDuration(){return this._config.animationDuration}set animationDuration(t){this._config.animationDuration=t}get iterations(){return this._config.iterations}set iterations(t){this._config.iterations=t}get color(){return this._config.color}set color(t){this._config.color!==t&&(this._config.color=t,this.refresh())}get strokeWidth(){return this._config.strokeWidth}set strokeWidth(t){this._config.strokeWidth!==t&&(this._config.strokeWidth=t,this.refresh())}get padding(){return this._config.padding}set padding(t){this._config.padding!==t&&(this._config.padding=t,this.refresh())}attach(){if(this._state==="unattached"&&this._e.parentElement){(function(){if(!window.__rno_kf_s){const n=window.__rno_kf_s=document.createElement("style");n.textContent="@keyframes rough-notation-dash { to { stroke-dashoffset: 0; } }",document.head.appendChild(n)}})();const t=this._svg=document.createElementNS(W,"svg");t.setAttribute("class","rough-annotation");const s=t.style;s.position="absolute",s.top="0",s.left="0",s.overflow="visible",s.pointerEvents="none",s.width="100px",s.height="100px";const i=this._config.type==="highlight";if(this._e.insertAdjacentElement(i?"beforebegin":"afterend",t),this._state="not-showing",i){const n=window.getComputedStyle(this._e).position;(!n||n==="static")&&(this._e.style.position="relative")}this.attachListeners()}}detachListeners(){window.removeEventListener("resize",this._resizeListener),this._ro&&this._ro.unobserve(this._e)}attachListeners(){this.detachListeners(),window.addEventListener("resize",this._resizeListener,{passive:!0}),!this._ro&&"ResizeObserver"in window&&(this._ro=new window.ResizeObserver(t=>{for(const s of t)s.contentRect&&this._resizeListener()})),this._ro&&this._ro.observe(this._e)}haveRectsChanged(){if(this._lastSizes.length){const t=this.rects();if(t.length!==this._lastSizes.length)return!0;for(let s=0;s<t.length;s++)if(!this.isSameRect(t[s],this._lastSizes[s]))return!0}return!1}isSameRect(t,s){const i=(n,a)=>Math.round(n)===Math.round(a);return i(t.x,s.x)&&i(t.y,s.y)&&i(t.w,s.w)&&i(t.h,s.h)}isShowing(){return this._state!=="not-showing"}refresh(){this.isShowing()&&!this.pendingRefresh&&(this.pendingRefresh=Promise.resolve().then(()=>{this.isShowing()&&this.show(),delete this.pendingRefresh}))}show(){switch(this._state){case"unattached":break;case"showing":this.hide(),this._svg&&this.render(this._svg,!0);break;case"not-showing":this.attach(),this._svg&&this.render(this._svg,!1)}}hide(){if(this._svg)for(;this._svg.lastChild;)this._svg.removeChild(this._svg.lastChild);this._state="not-showing"}remove(){this._svg&&this._svg.parentElement&&this._svg.parentElement.removeChild(this._svg),this._svg=void 0,this._state="unattached",this.detachListeners()}render(t,s){let i=this._config;s&&(i=JSON.parse(JSON.stringify(this._config)),i.animate=!1);const n=this.rects();let a=0;n.forEach(c=>a+=c.w);const r=i.animationDuration||800;let o=0;for(let c=0;c<n.length;c++){const w=r*(n[c].w/a);F(t,n[c],i,o+this._animationDelay,w,this._seed),o+=w}this._lastSizes=n,this._state="showing"}rects(){const t=[];if(this._svg)if(this._config.multiline){const s=this._e.getClientRects();for(let i=0;i<s.length;i++)t.push(this.svgRect(this._svg,s[i]))}else t.push(this.svgRect(this._svg,this._e.getBoundingClientRect()));return t}svgRect(t,s){const i=t.getBoundingClientRect(),n=s;return{x:(n.x||n.left)-(i.x||i.left),y:(n.y||n.top)-(i.y||i.top),w:n.width,h:n.height}}}function j(e,t){return new J(e,t)}function B(e){let t=0;for(const i of e){const n=i;n._animationDelay=t,t+=n.animationDuration===0?0:n.animationDuration||800}const s=[...e];return{show(){for(const i of s)i.show()},hide(){for(const i of s)i.hide()}}}const T=document.querySelectorAll("span[data-notation]");function z(e,t,s){return e.dataset[`notation${t.split("-").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join("")}`]??s}const G=new Array(T.length).fill(0).map((e,t)=>{const s=T[t],i=z(s,"","underline"),n=z(s,"color","red"),a=j(s,{type:i,color:n,animate:!1,multiline:i!=="bracket",brackets:z(s,"brackets")?.split(",")||["left","right"],strokeWidth:Number(z(s,"strokeWidth","1.5"))}),r=z(s,"hover-color");return r&&(s.onmouseenter=()=>{a.color=r},s.onmouseleave=()=>{a.color=n}),a});B(G).show();
